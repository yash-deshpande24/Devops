## Quick checklist before starting (AWS console)
- AMI: Ubuntu 24.04 LTS
- Instance type: t2.medium
- Name tag: e.g., `jenkins-server`
- Key pair: create & download `.pem`
- Root storage: 20 GB
- Public IP or Elastic IP: assign if remote access needed
- Security Group inbound rules:
  - SSH (22) from your IP
  - TCP 8080 (Jenkins) from your IP (recommended)
  - HTTP/HTTPS (80/443) if using reverse proxy
- Optional: IAM role for S3 / ECR access

---

## Step 1 — Create EC2 instance (console or CLI example)
Console: create instance with settings above.

AWS CLI example (replace placeholders):
```bash
aws ec2 run-instances \
  --image-id ami-XXXXXXXXXXXXXXX \
  --instance-type t2.medium \
  --key-name my-keypair \
  --subnet-id subnet-XXXXXXXX \
  --security-group-ids sg-XXXXXXXX \
  --count 1 \
  --block-device-mappings DeviceName=/dev/sda1,Ebs={VolumeSize=20} \
  --tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=jenkins-server}]'
```

Connect:
```bash
chmod 400 my-keypair.pem
ssh -i my-keypair.pem ubuntu@<EC2_PUBLIC_IP>
```

---

## Step 2 — Install Jenkins (on the Ubuntu VM)

1. Update OS and install prerequisites
```bash
sudo apt update
sudo apt install -y wget gnupg ca-certificates fontconfig
```

2. Install Java (OpenJDK 21)
```bash
sudo apt install -y openjdk-21-jre
java -version
# expected output: openjdk 21.x
```

3. Add Jenkins APT repository and install Jenkins
```bash
sudo wget -O /etc/apt/keyrings/jenkins-keyring.asc \
  https://pkg.jenkins.io/debian-stable/jenkins.io-2023.key

echo "deb [signed-by=/etc/apt/keyrings/jenkins-keyring.asc] https://pkg.jenkins.io/debian-stable binary/" | \
  sudo tee /etc/apt/sources.list.d/jenkins.list > /dev/null

sudo apt update
sudo apt install -y jenkins
```

4. Start and enable Jenkins
```bash
sudo systemctl enable --now jenkins
sudo systemctl status jenkins --no-pager
```

5. Open port (if using UFW)
```bash
# allow SSH first to avoid lockout
sudo ufw allow OpenSSH
sudo ufw allow 8080/tcp
sudo ufw enable
sudo ufw status
```

6. Ensure AWS Security Group has TCP 8080 inbound from your IP.

7. Get initial admin password and open Jenkins
```bash
sudo cat /var/lib/jenkins/secrets/initialAdminPassword
# in your workstation, open:
# $BROWSER http://<EC2_PUBLIC_IP>:8080
```

8. Complete GUI setup
- Paste initial admin password.
- Install suggested plugins (or choose manually).
- Create first admin user.
- Set Jenkins URL to your domain or IP.

---
## Optional — Reverse proxy + HTTPS (recommended for production)
Install nginx and certbot:
```bash
sudo apt install -y nginx certbot python3-certbot-nginx
```
Basic nginx site config (example):
```nginx
server {
    listen 80;
    server_name jenkins.example.com;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```
Enable and get TLS:
```bash
sudo ln -s /etc/nginx/sites-available/jenkins /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
sudo certbot --nginx -d jenkins.example.com
```

Configure Jenkins `Manage Jenkins -> Configure System` with the correct Jenkins URL (https://jenkins.example.com).

---

## Post-install best practices (short)
- Restrict access via Security Groups or VPN.
- Use HTTPS and a proper domain.
- Use Jenkins credentials store for secrets.
- Back up `/var/lib/jenkins` and config.xml regularly.
- Apply OS and plugin updates on a staging Jenkins first.
- Use least-privilege IAM roles for cloud access.
- Consider running Jenkins agents in containers or autoscaling groups.

---

## Troubleshooting tips
- Service logs: `sudo journalctl -u jenkins -f`
- Port 8080 in use: `sudo ss -ltnp | grep 8080`
- Disk space: `df -h`
- If locked out by UFW, use EC2 serial console or stop/modify instance.

---

## Useful commands & tips
- Open Jenkins from dev container host:
```bash
$BROWSER http://<EC2_PUBLIC_IP>:8080
```
- Save your keypair with `chmod 400` locally.
- If using ECR or S3, attach an IAM role to the instance and install AWS CLI.

---

## Minimal example Jenkinsfile
```groovy
pipeline {
  agent any
  stages {
    stage('Checkout') { steps { checkout scm } }
    stage('Build')    { steps { sh 'make build' } }
    stage('Test')     { steps { sh 'make test' } }
    stage('Package')  { steps { sh 'make package' } }
  }
  post { always { archiveArtifacts artifacts: 'build/**', fingerprint: true } }
}
```

---

If you want, I can:
- Add an nginx site file (full content) and systemd steps.
- Create an AMI/Cloud-init user-data example to provision Jenkins automatically.
- Generate AWS CLI commands filled with your region/AMI/subnet/security-group values.
