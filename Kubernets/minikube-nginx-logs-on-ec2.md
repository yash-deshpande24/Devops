# NGINX Logs with Kubernetes Deployment on EC2 (Minikube)

This guide sets up an **NGINX Deployment** in Kubernetes (running via Minikube on your EC2 instance) that stores **access** and **error logs** persistently in a host-mounted directory `/home/ubuntu/nginx-logs`. You can then generate logs by accessing NGINX via browser or from inside the container.

---

## üß© 1. Create Deployment and Service YAML

Save this as `nginx-logs-deploy.yaml`:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deploy
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx-deploy
  template:
    metadata:
      labels:
        app: nginx-deploy
    spec:
      containers:
        - name: nginx
          image: nginx:alpine
          ports:
            - containerPort: 80
          volumeMounts:
            - name: nginx-logs
              mountPath: /var/log/nginx
      volumes:
        - name: nginx-logs
          hostPath:
            path: /home/ubuntu/nginx-logs
            type: DirectoryOrCreate
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-nodeport
spec:
  type: NodePort
  selector:
    app: nginx-deploy
  ports:
    - port: 80
      targetPort: 80
      nodePort: 30080
```

---

## ‚öôÔ∏è 2. Prepare Host Directory

On your EC2 instance (Minikube node), create a folder to store NGINX logs:

```bash
minikube ssh -- "sudo mkdir -p /home/ubuntu/nginx-logs && sudo chmod 0777 /home/ubuntu/nginx-logs"
```

---

## üöÄ 3. Deploy NGINX

```bash
kubectl apply -f nginx-logs-deploy.yaml
kubectl get pods -l app=nginx-deploy
```

Wait until the pod status shows `Running`.

---

## üåê 4. Access the NGINX Page

### ‚úÖ Option 1: Port-Forwarding (Access from Browser)

```bash
kubectl port-forward svc/nginx-nodeport 8080:80 --address 0.0.0.0
```

Now open the NGINX welcome page:

* `http://<your-EC2-public-IP>:8080`

Each page refresh will generate new entries in the access log.

---

### ‚úÖ Option 2: Generate Logs from Inside the Container

```bash
# Get Pod Name
kubectl get pods -l app=nginx-deploy

# Go inside the container
kubectl exec -it <pod-name> -- sh

# Inside the container
curl 127.0.0.1
curl 127.0.0.1/index.html
curl 127.0.0.1/invalid-page  # will generate an error log

# Check logs inside container
cat /var/log/nginx/access.log
cat /var/log/nginx/error.log
exit
```

---

## ü™£ 5. Verify Logs on EC2 Host

Since you mounted `/home/ubuntu/nginx-logs`, check the logs from your EC2 terminal:

```bash
minikube ssh -- "ls -la /home/ubuntu/nginx-logs"
minikube ssh -- "sudo tail -n 30 /home/ubuntu/nginx-logs/access.log"
minikube ssh -- "sudo tail -n 30 /home/ubuntu/nginx-logs/error.log"
```

You should see entries generated by your browser or curl requests.

---

## üßπ 6. Cleanup

When done testing:

```bash
kubectl delete -f nginx-logs-deploy.yaml
```

---

## ‚úÖ Quick Recap

| Task                   | Command                                                                                              |
| ---------------------- | ---------------------------------------------------------------------------------------------------- |
| Create folder on EC2   | `minikube ssh -- "sudo mkdir -p /home/ubuntu/nginx-logs && sudo chmod 0777 /home/ubuntu/nginx-logs"` |
| Deploy NGINX           | `kubectl apply -f nginx-logs-deploy.yaml`                                                            |
| Access NGINX (browser) | `kubectl port-forward svc/nginx-nodeport 8080:80 --address 0.0.0.0`                                  |
| Go inside pod          | `kubectl exec -it <pod> -- sh`                                                                       |
| Generate logs          | `curl 127.0.0.1`                                                                                     |
| View logs on EC2       | `minikube ssh -- "tail -f /home/ubuntu/nginx-logs/access.log"`                                       |

---

> üß† **Tip:** You can also set up a CronJob later to clean or archive `/home/ubuntu/nginx-logs` periodically if the folder grows large.
